<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet"
          type="text/css"
          href="styles.css"/>
    <title>Gjestebok - Joakim Lindquister</title>
    <meta name="description" content="Legg igjen en melding i gjesteboken til Joakim Lindquister">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Gjestebok - Joakim Lindquister">
    <meta property="og:description" content="Legg igjen en melding i gjesteboken">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <nav class="links">
        <div class="link-buttons">
            <div class="box">
                <a href="index.html">ğŸ  Hjem</a>
            </div>
            <div class="box">
                <a href="gjestebok.html" class="active">ğŸ“ Gjestebok</a>
            </div>
            <div class="box">
                <a href="https://github.com/quist" target="_blank">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    GitHub â†—
                </a>
            </div>
            <div class="box">
                <a href="https://no.linkedin.com/in/joakim-lindquister-8a037865" target="_blank">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                    LinkedIn â†—
                </a>
            </div>
            <div class="box">
                <a href="mailto:joakiml@gmail.com">âœ‰ï¸ Get in Touch</a>
            </div>
        </div>
    </nav>

    <div class="cards">
        <div class="card guestbook-form-card">
            <h2>âœï¸ Skriv en melding</h2>
            <form id="guestbook-form" class="guestbook-form">
                <div class="form-group">
                    <label for="name">Navn:</label>
                    <input type="text" id="name" name="name" required maxlength="50" placeholder="Ditt navn">
                </div>
                <div class="form-group">
                    <label for="message">Melding:</label>
                    <textarea id="message" name="message" required maxlength="500" rows="4" placeholder="Skriv din melding her..."></textarea>
                </div>
                <!-- Honeypot (skal vÃ¦re tom) -->
                <div style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
                    <label for="website">Nettsted</label>
                    <input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
                </div>
                <button type="submit" class="submit-btn">ğŸ“ Send melding</button>
            </form>
        </div>

        <div class="card guestbook-messages-card">
            <h2>ğŸ’¬ Meldinger fra gjester</h2>
            <div id="messages-container" class="messages-container">
                <div class="no-messages">
                    <p>Ingen meldinger ennÃ¥. VÃ¦r den fÃ¸rste til Ã¥ skrive! âœ¨</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Built with âœ¨ and Claude Code</p>
    </footer>
</div>

<script type="module">
// Firebase + Firestore-basert gjestebok
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';

class Guestbook {
    constructor() {
        this.form = document.getElementById('guestbook-form');
        this.messagesContainer = document.getElementById('messages-container');
        this.initFirebase();
        this.init();
    }

    initFirebase() {
        // Fyll inn din egen Firebase-konfig fra Firebase Console
        const firebaseConfig = {
            apiKey: "AIzaSyAnTRBovMt9B2dV-MorT3OQEvji2JFBXrg",
            authDomain: "quister-homepage.firebaseapp.com",
            projectId: "quister-homepage",
            storageBucket: "quister-homepage.appspot.com",
            messagingSenderId: "410861821179",
            appId: "1:410861821179:web:63be3919cbb196665d645e"
        };
        const app = initializeApp(firebaseConfig);
        this.db = getFirestore(app);
        this.messagesRef = collection(this.db, 'guestbookMessages');
    }

    init() {
        this.subscribeToMessages();
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
    }

    async handleSubmit(e) {
        e.preventDefault();

        const formData = new FormData(this.form);
        const name = (formData.get('name') || '').toString().trim();
        const message = (formData.get('message') || '').toString().trim();
        const honeypot = (formData.get('website') || '').toString().trim();

        if (honeypot) {
            // Bot-indikator, ignorer innsendingen lydlÃ¸st
            return;
        }

        if (!name || !message) {
            alert('Vennligst fyll ut alle feltene');
            return;
        }

        if (name.length > 50 || message.length > 500) {
            alert('Ugyldig lengde pÃ¥ felter');
            return;
        }

        try {
            await addDoc(this.messagesRef, {
                name,
                message,
                createdAt: serverTimestamp()
            });
            this.form.reset();
            this.showSuccessMessage();
        } catch (err) {
            console.error('Kunne ikke lagre melding:', err);
            alert('Kunne ikke lagre meldingen. PrÃ¸v igjen.');
        }
    }

    subscribeToMessages() {
        const q = query(this.messagesRef, orderBy('createdAt', 'desc'));
        onSnapshot(q, (snapshot) => {
            const items = snapshot.docs.map(doc => {
                const data = doc.data();
                return {
                    id: doc.id,
                    name: data.name || '',
                    message: data.message || '',
                    timestamp: data.createdAt?.toDate ? data.createdAt.toDate().toISOString() : new Date().toISOString()
                };
            });
            this.renderMessages(items);
        }, (error) => {
            console.error('Feil ved henting av meldinger:', error);
        });
    }

    renderMessages(messages) {
        if (!messages || messages.length === 0) {
            this.messagesContainer.innerHTML = `
                <div class=\"no-messages\">
                    <p>Ingen meldinger ennÃ¥. VÃ¦r den fÃ¸rste til Ã¥ skrive! âœ¨</p>
                </div>
            `;
            return;
        }

        const messagesHtml = messages.map(message => `
            <div class=\"message\" data-id=\"${message.id}\">\n                <div class=\"message-header\">\n                    <span class=\"message-name\">ğŸ‘¤ ${this.escapeHtml(message.name)}</span>\n                    <span class=\"message-date\">${this.formatDate(message.timestamp)}</span>\n                </div>\n                <div class=\"message-content\">\n                    ${this.escapeHtml(message.message)}\n                </div>\n            </div>
        `).join('');

        this.messagesContainer.innerHTML = messagesHtml;
    }

    formatDate(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays === 0) {
            return 'I dag ' + date.toLocaleTimeString('no', { hour: '2-digit', minute: '2-digit' });
        } else if (diffDays === 1) {
            return 'I gÃ¥r ' + date.toLocaleTimeString('no', { hour: '2-digit', minute: '2-digit' });
        } else if (diffDays < 7) {
            return diffDays + ' dager siden';
        } else {
            return date.toLocaleDateString('no');
        }
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    showSuccessMessage() {
        const button = this.form.querySelector('.submit-btn');
        const originalText = button.textContent;
        button.textContent = 'âœ… Sendt!';
        button.disabled = true;

        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
        }, 2000);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new Guestbook();
});
</script>
</body>
</html>